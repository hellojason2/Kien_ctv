<!-- Overview Page -->
<div class="page-section active" id="page-overview">
    <div class="header">
        <h2 data-i18n="dashboard_overview">Dashboard Overview</h2>

        <div class="header-toolbar" style="display: flex; align-items: center; gap: 24px;">
            <!-- Group 1: Status Indicators -->
            <div class="status-group"
                style="display: flex; align-items: center; gap: 12px; padding-right: 24px; border-right: 2px solid #e5e7eb;">
                <!-- Google Sheet Variable Status Checker -->
                <div class="sync-status-container" id="googleStatusContainer" data-i18n-tooltip="checking_vars">
                    <span class="sync-status-dot" id="googleStatusDot" style="background-color: #ccc;"></span>
                    <span class="sync-status-text" id="googleStatusText" data-i18n="checking_vars">Checking
                        Vars...</span>
                </div>

                <!-- Sync Worker Status Indicator -->
                <div class="sync-status-container" id="syncStatusContainer" onclick="resetSyncCounter()"
                    data-i18n-tooltip="click_to_clear">
                    <span class="sync-status-dot" id="syncStatusDot"></span>
                    <span class="sync-status-text" id="syncStatusText" data-i18n="checking_vars">Checking...</span>
                    <span class="sync-badge" id="syncBadge" style="display: none;">0</span>
                </div>

                <!-- Row Count Indicators -->
                <div class="row-count-indicators" id="rowCountIndicators">
                    <div class="row-count-box" id="rowCountTM" data-i18n-tooltip="tm_tooltip">
                        <span class="row-count-label">TM</span>
                        <span class="row-count-value" id="rowCountTMValue">-/-</span>
                    </div>
                    <div class="row-count-box" id="rowCountNK" data-i18n-tooltip="nk_tooltip">
                        <span class="row-count-label">NK</span>
                        <span class="row-count-value" id="rowCountNKValue">-/-</span>
                    </div>
                    <div class="row-count-box" id="rowCountGT" data-i18n-tooltip="gt_tooltip">
                        <span class="row-count-label">GT</span>
                        <span class="row-count-value" id="rowCountGTValue">-/-</span>
                    </div>
                </div>
            </div>

            <!-- Group 2: Actions -->
            <div class="actions-group" style="display: flex; align-items: center; gap: 8px;">
                <!-- Sync Button -->
                <button id="syncNowBtn" onclick="manualSync()"
                    style="padding: 6px 12px; font-size: 13px; background: #dcfce7; color: #166534; border: 1px solid #bbf7d0; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                    <span style="font-weight: bold;">âŸ³</span> <span data-i18n="sync_now">Sync Now</span>
                </button>

                <!-- Check Duplicates Button -->
                <button id="checkDupesBtn" onclick="confirmDuplicateCleanup()"
                    style="padding: 6px 12px; font-size: 13px; background: #e0f2fe; color: #0369a1; border: 1px solid #bae6fd; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                    <span style="font-weight: bold;">ðŸ§¹</span> <span data-i18n="check_duplicates">Check
                        Duplicates</span>
                </button>

                <!-- Hard Reset Button -->
                <button id="hardResetBtn" onclick="confirmHardReset()"
                    style="padding: 6px 12px; font-size: 13px; background: #fee2e2; color: #b91c1c; border: 1px solid #fecaca; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: all 0.2s;">
                    <span style="font-weight: bold;">â†»</span> <span data-i18n="hard_reset">Hard Reset</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Date Filter Card -->
    <div class="card" style="margin-bottom: 20px;">
        <div class="card-body" style="padding: 16px;">
            <div class="date-filter-section">
                <label class="filter-label" data-i18n="quick_filters">Quick Filters</label>
                <div class="quick-filter-buttons">
                    <!-- Quick Filter Buttons -->
                    <button class="quick-filter-btn" data-preset="today" onclick="applyOverviewPreset('today')"
                        data-i18n="today">Today<span class="data-indicator"></span></button>
                    <button class="quick-filter-btn" data-preset="3days" onclick="applyOverviewPreset('3days')"
                        data-i18n="three_days">3 Days<span class="data-indicator"></span></button>
                    <button class="quick-filter-btn" data-preset="week" onclick="applyOverviewPreset('week')"
                        data-i18n="week">This Week<span class="data-indicator"></span></button>
                    <button class="quick-filter-btn active" data-preset="month" onclick="applyOverviewPreset('month')"
                        data-i18n="this_month">This Month<span class="data-indicator"></span></button>
                    <button class="quick-filter-btn" data-preset="lastmonth" onclick="applyOverviewPreset('lastmonth')"
                        data-i18n="last_month">Last Month<span class="data-indicator"></span></button>
                    <button class="quick-filter-btn" data-preset="3months" onclick="applyOverviewPreset('3months')"
                        data-i18n="three_months">3 Months<span class="data-indicator"></span></button>
                    <button class="quick-filter-btn" data-preset="year" onclick="applyOverviewPreset('year')"
                        data-i18n="this_year">This Year<span class="data-indicator"></span></button>
                    <button class="quick-filter-btn" data-preset="custom" onclick="toggleOverviewCustomDateFilter()"
                        data-i18n="custom_range">Custom</button>
                </div>
            </div>
            <!-- Custom Date Range (hidden by default) -->
            <div id="overviewCustomDateFilter" class="custom-date-filter" style="display: none; margin-top: 12px;">
                <div style="display: flex; flex-wrap: wrap; gap: 12px; align-items: center;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label data-i18n="from_date"
                            style="font-size: 14px; color: var(--text-secondary);">From:</label>
                        <input type="date" id="overviewFromDate" class="date-input">
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <label data-i18n="to_date" style="font-size: 14px; color: var(--text-secondary);">To:</label>
                        <input type="date" id="overviewToDate" class="date-input">
                    </div>
                    <button class="btn-filter" onclick="applyOverviewCustomDateFilter()"
                        data-i18n="filter">Filter</button>
                </div>
            </div>
        </div>
    </div>

    <div class="stats-grid" id="statsGrid">
        <div class="stat-card cyan">
            <div class="label" data-i18n="total_ctv">Total CTV</div>
            <div class="value" id="statTotalCTV">-</div>
        </div>
        <div class="stat-card green">
            <div class="label" data-i18n="monthly_commission">Monthly Commission</div>
            <div class="value" id="statMonthlyCommission">-</div>
        </div>
        <div class="stat-card orange">
            <div class="label" data-i18n="monthly_transactions">Monthly Transactions</div>
            <div class="value" id="statMonthlyTx">-</div>
        </div>
        <div class="stat-card purple">
            <div class="label" data-i18n="monthly_revenue">Monthly Revenue</div>
            <div class="value" id="statMonthlyRevenue">-</div>
        </div>
    </div>
    <div class="card">
        <div class="card-header">
            <h3 data-i18n="top_earners">Top Earners This Month</h3>
        </div>
        <div class="card-body" style="padding: 0;">
            <div class="table-container responsive-card-table">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th data-i18n="id" style="width: 60px;">#</th>
                            <th data-i18n="ctv_name">Name</th>
                            <th data-i18n="ctv_code">Code</th>
                            <th data-i18n="total_revenue" style="text-align: right;">Total Revenue</th>
                            <th data-i18n="total_commission" style="text-align: right;">Total Commission</th>
                        </tr>
                    </thead>
                    <tbody id="topEarnersTableBody">
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px; color: var(--text-secondary);">
                                <div class="loading" data-i18n="loading">Loading...</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Duplicate Cleanup Modal -->
<div id="cleanupModal" class="progress-modal-overlay" style="display: none;">
    <div class="progress-modal" style="max-width: 550px;">
        <div class="progress-modal-header">
            <div class="progress-modal-icon" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                </svg>
            </div>
            <h3 data-i18n="cleanup_progress">Cleanup In Progress</h3>
            <p class="progress-modal-subtitle" data-i18n="cleanup_subtitle">Scanning for duplicates based on Date, Time,
                Name & Service...</p>
        </div>

        <!-- Cleanup Status -->
        <div class="sync-status-display" style="padding: 20px; text-align: center;">
            <div class="sync-spinner" id="cleanupSpinner"
                style="width: 40px; height: 40px; border: 3px solid #e5e7eb; border-top-color: #0ea5e9; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;">
            </div>
            <div id="cleanupStatusText" style="font-weight: 600; color: #374151;" data-i18n="starting">Starting...</div>
        </div>

        <!-- Cleanup Log -->
        <div class="sync-log-panel"
            style="max-height: 300px; overflow-y: auto; margin: 0 20px; padding: 12px; background: #f9fafb; border-radius: 8px; font-family: monospace; font-size: 12px;">
            <div id="cleanupLogEntries"></div>
        </div>

        <!-- Cleanup Summary -->
        <div class="sync-summary" id="cleanupSummary" style="display: none; padding: 20px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 12px;">âœ“</div>
            <h4 style="margin: 0 0 16px; color: #166534;" id="cleanupResultTitle" data-i18n="cleanup_complete">Cleanup
                Complete!</h4>
            <div id="cleanupStats"
                style="text-align: left; background: #f0fdf4; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
            </div>
            <button class="btn-close-modal" onclick="closeCleanupModal()"
                style="background: #0ea5e9; color: white; border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;"
                data-i18n="close">Close</button>
        </div>
    </div>
</div>

<!-- Hard Reset Progress Modal -->
<div id="hardResetModal" class="progress-modal-overlay" style="display: none;">
    <div class="progress-modal" style="max-width: 600px;">
        <div class="progress-modal-header">
            <div class="progress-modal-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </div>
            <h3 data-i18n="hard_reset_progress">Hard Reset In Progress</h3>
            <p class="progress-modal-subtitle" data-i18n="hard_reset_subtitle">Please wait while we sync your data...
            </p>
        </div>

        <div class="progress-steps">
            <!-- Step 0: Reading Database -->
            <div class="progress-step" id="step-read">
                <div class="step-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M4 7v10c0 2.21 3.582 4 8 4s8-1.79 8-4V7M4 7c0 2.21 3.582 4 8 4s8-1.79 8-4M4 7c0-2.21 3.582-4 8-4s8 1.79 8 4m0 5c0 2.21-3.582 4-8 4s-8-1.79-8-4" />
                    </svg>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <span class="step-title" data-i18n="step_read">Reading Database</span>
                        <span class="step-status" id="step-read-status">Waiting...</span>
                    </div>
                    <div class="step-progress-bar">
                        <div class="step-progress-fill" id="step-read-progress"></div>
                    </div>
                    <div class="step-detail" id="step-read-detail">Counting existing records...</div>
                    <!-- Database counts display -->
                    <div class="db-counts" id="dbCounts"
                        style="display: none; margin-top: 10px; padding: 10px; background: rgba(0,0,0,0.03); border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 12px;">
                            <div><strong>Tháº©m Má»¹:</strong> <span id="count-tham-my">-</span></div>
                            <div><strong>Nha Khoa:</strong> <span id="count-nha-khoa">-</span></div>
                            <div><strong>Giá»›i Thiá»‡u:</strong> <span id="count-gioi-thieu">-</span></div>
                            <div><strong>Commissions:</strong> <span id="count-commissions">-</span></div>
                        </div>
                        <div
                            style="margin-top: 8px; padding-top: 8px; border-top: 1px solid rgba(0,0,0,0.1); font-weight: 700; color: #b91c1c;">
                            Total Records to Delete: <span id="count-total">-</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 1: Delete -->
            <div class="progress-step" id="step-delete">
                <div class="step-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
                    </svg>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <span class="step-title" data-i18n="step_clearing">Clearing Database</span>
                        <span class="step-status" id="step-delete-status">Waiting...</span>
                    </div>
                    <div class="step-progress-bar">
                        <div class="step-progress-fill" id="step-delete-progress"></div>
                    </div>
                    <div class="step-detail" id="step-delete-detail">Preparing to delete existing records...</div>
                </div>
            </div>

            <!-- Step 2: Beauty Import -->
            <div class="progress-step" id="step-beauty">
                <div class="step-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <span class="step-title" data-i18n="step_beauty">Importing Beauty Data</span>
                        <span class="step-status" id="step-beauty-status">Waiting...</span>
                    </div>
                    <div class="step-progress-bar">
                        <div class="step-progress-fill" id="step-beauty-progress"></div>
                    </div>
                    <div class="step-detail" id="step-beauty-detail">Extracting from Tháº©m Má»¹ sheet...</div>
                </div>
            </div>

            <!-- Step 3: Dental Import -->
            <div class="progress-step" id="step-dental">
                <div class="step-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M12 14l9-5-9-5-9 5 9 5z M12 14l6.16-3.422a12.083 12.083 0 01.665 6.479A11.952 11.952 0 0012 20.055a11.952 11.952 0 00-6.824-2.998 12.078 12.078 0 01.665-6.479L12 14z" />
                    </svg>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <span class="step-title" data-i18n="step_dental">Importing Dental Data</span>
                        <span class="step-status" id="step-dental-status">Waiting...</span>
                    </div>
                    <div class="step-progress-bar">
                        <div class="step-progress-fill" id="step-dental-progress"></div>
                    </div>
                    <div class="step-detail" id="step-dental-detail">Extracting from Nha Khoa sheet...</div>
                </div>
            </div>

            <!-- Step 4: Referral Import -->
            <div class="progress-step" id="step-referral">
                <div class="step-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
                    </svg>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <span class="step-title" data-i18n="step_referral">Importing Referral Data</span>
                        <span class="step-status" id="step-referral-status">Waiting...</span>
                    </div>
                    <div class="step-progress-bar">
                        <div class="step-progress-fill" id="step-referral-progress"></div>
                    </div>
                    <div class="step-detail" id="step-referral-detail">Extracting from Giá»›i Thiá»‡u sheet...</div>
                </div>
            </div>

            <!-- Step 5: Commission Calculation -->
            <div class="progress-step" id="step-commission">
                <div class="step-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path
                            d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                    </svg>
                </div>
                <div class="step-content">
                    <div class="step-header">
                        <span class="step-title" data-i18n="step_commission">Calculating Commissions</span>
                        <span class="step-status" id="step-commission-status">Waiting...</span>
                    </div>
                    <div class="step-progress-bar">
                        <div class="step-progress-fill" id="step-commission-progress"></div>
                    </div>
                    <div class="step-detail" id="step-commission-detail">Recalculating all commission levels...</div>
                </div>
            </div>
        </div>

        <!-- Activity Log Panel -->
        <div class="progress-log-panel">
            <div class="log-header" onclick="toggleLogPanel()">
                <span data-i18n="activity_logs">ðŸ“‹ Activity Log</span>
                <span class="log-toggle" id="logToggle">â–¼</span>
            </div>
            <div class="log-content" id="logContent" style="display: none;">
                <div class="log-entries" id="logEntries"></div>
            </div>
        </div>

        <!-- Summary (shown when complete) -->
        <div class="progress-summary" id="progressSummary" style="display: none;">
            <div class="summary-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <span data-i18n="reset_complete">Reset Complete!</span>
            </div>
            <div class="summary-stats" id="summaryStats"></div>
            <button class="btn-close-modal" onclick="closeHardResetModal()" data-i18n="close">Close</button>
        </div>
    </div>
</div>

<!-- Sync Progress Modal -->
<div id="syncModal" class="progress-modal-overlay" style="display: none;">
    <div class="progress-modal" style="max-width: 550px;">
        <div class="progress-modal-header">
            <div class="progress-modal-icon" style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path
                        d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15" />
                </svg>
            </div>
            <h3 data-i18n="sync_progress">Sync In Progress</h3>
            <p class="progress-modal-subtitle" data-i18n="sync_subtitle">Pulling new records from Google Sheets...</p>
        </div>

        <!-- Sync Status -->
        <div class="sync-status-display" id="syncStatusDisplay" style="padding: 20px; text-align: center;">
            <div class="sync-spinner"
                style="width: 40px; height: 40px; border: 3px solid #e5e7eb; border-top-color: #22c55e; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 16px;">
            </div>
            <div id="syncCurrentStep" style="font-weight: 600; color: #374151;">Connecting...</div>
        </div>

        <!-- Sync Log -->
        <div class="sync-log-panel"
            style="max-height: 300px; overflow-y: auto; margin: 0 20px; padding: 12px; background: #f9fafb; border-radius: 8px; font-family: monospace; font-size: 12px;">
            <div id="syncLogEntries"></div>
        </div>

        <!-- Summary (shown when complete) -->
        <div class="sync-summary" id="syncSummary" style="display: none; padding: 20px; text-align: center;">
            <div style="font-size: 48px; margin-bottom: 12px;">âœ“</div>
            <h4 style="margin: 0 0 16px; color: #166534;" data-i18n="sync_complete">Sync Complete!</h4>
            <div id="syncSummaryStats"
                style="text-align: left; background: #f0fdf4; padding: 16px; border-radius: 8px; margin-bottom: 16px;">
            </div>
            <button class="btn-close-modal" onclick="closeSyncModal()"
                style="background: #22c55e; color: white; border: none; padding: 10px 24px; border-radius: 8px; cursor: pointer; font-weight: 600;"
                data-i18n="close">Close</button>
        </div>
    </div>
</div>

<style>
    @keyframes spin {
        to {
            transform: rotate(360deg);
        }
    }

    .sync-log-entry {
        padding: 4px 0;
        border-bottom: 1px solid #e5e7eb;
    }

    .sync-log-entry:last-child {
        border-bottom: none;
    }

    .sync-log-entry.info {
        color: #374151;
    }

    .sync-log-entry.success {
        color: #166534;
    }

    .sync-log-entry.warning {
        color: #b45309;
    }

    .sync-log-entry.error {
        color: #b91c1c;
    }
</style>

<script>
    // Logic for Duplicate Cleanup
    function confirmDuplicateCleanup() {
        if (confirm("Check and remove duplicate rows? This will check matches by Date, Time, Name and Service.")) {
            openCleanupModal();
            startDuplicateCleanup();
        }
    }

    function openCleanupModal() {
        document.getElementById('cleanupModal').style.display = 'flex';
        document.getElementById('cleanupSummary').style.display = 'none';
        document.getElementById('cleanupLogEntries').innerHTML = '';
        document.getElementById('cleanupStatusText').textContent = 'Starting...';
        document.getElementById('cleanupSpinner').style.display = 'block';
    }

    function closeCleanupModal() {
        document.getElementById('cleanupModal').style.display = 'none';
        location.reload(); // Refresh to show correct data
    }

    function startDuplicateCleanup() {
        const logContainer = document.getElementById('cleanupLogEntries');

        // Use fetch with ReadableStream for real-time logs
        fetch('/api/admin/remove-duplicates', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
        })
            .then(response => {
                const reader = response.body.getReader();
                const decoder = new TextDecoder();

                function readStream() {
                    reader.read().then(({ done, value }) => {
                        if (done) return;

                        const chunk = decoder.decode(value);
                        const lines = chunk.split('\n\n');

                        lines.forEach(line => {
                            if (line.startsWith('data: ')) {
                                try {
                                    const data = JSON.parse(line.substring(6));

                                    // Log message
                                    if (data.message) {
                                        const entry = document.createElement('div');
                                        entry.className = `sync-log-entry ${data.type || 'info'}`;
                                        entry.textContent = `> ${data.message}`;
                                        logContainer.appendChild(entry);
                                        logContainer.scrollTop = logContainer.scrollHeight; // Auto-scroll

                                        document.getElementById('cleanupStatusText').textContent = data.message;
                                    }

                                    // Completion
                                    if (data.done) {
                                        showCleanupSummary(data.count);
                                    }
                                } catch (e) {
                                    console.error('Error parsing SSE data', e);
                                }
                            }
                        });

                        readStream();
                    });
                }

                readStream();
            })
            .catch(error => {
                const entry = document.createElement('div');
                entry.className = "sync-log-entry error";
                entry.textContent = `> Connection failed: ${error}`;
                logContainer.appendChild(entry);
            });
    }

    function showCleanupSummary(count) {
        document.getElementById('cleanupSpinner').style.display = 'none';
        document.getElementById('cleanupSummary').style.display = 'block';

        document.getElementById('cleanupStats').innerHTML = `
        <div style="font-weight: 500;">
            <div style="margin-bottom: 4px;">Deleted Rows: <strong>${count}</strong></div>
            <div style="font-size: 13px; color: #666;">Database logic applied: Keep oldest ID, delete comparisons matching Phone, Date, Time, Name, Service & Source.</div>
        </div>
    `;
    }
</script>